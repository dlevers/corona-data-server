<h1>Show Territory : "<%= @parentTerritory %>"</h1>

<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback( drawGraphTerritories );


      function drawGraphTerritories() {
        <% @uTerritories.each do |oneTerritory| %>
            <% cleanTerritory = oneTerritory.gsub( /[^0-9a-z]/i, '' ) %>
            var data = google.visualization.arrayToDataTable([
                ['Date', 'Active', 'Recovered', 'Deaths'],
                <% @dailies.where( :territory => oneTerritory ).sort_by( &:date ).each do |daily| %>
                  [ "<%= daily.date[ 5..-1 ] %>", <%= daily.confirmed.to_i %> - <%= daily.recovered.to_i %> - <%= daily.deaths.to_i %>, <%= daily.recovered.to_i %>, <%= daily.deaths.to_i %> ],
                <% end %>
              ]);

            // Add chartArea.width at (48%) so that my labels do not get truncated
            var options = {
                title: 'Cases: <%= oneTerritory %>',
                hAxis: { title: 'Date',
                        titleTextStyle: { color: '#333' },
                        slantedText: true,
                        slantedTextAngle: 90 },
                vAxis: {minValue: 0},
                isStacked: true,
                series: [
                    {color: 'yellow'},
                    {color: 'green'},
                    {color: 'red'} ],
                chartArea: { width: "48%",
                      height: "55%" }
              };

            var chart = new google.visualization.AreaChart(document.getElementById('chart_div_<%= cleanTerritory %>'));
            google.visualization.events.addListener( chart, 'click', clickHandler_<%= cleanTerritory %> );
            chart.draw( data, options );

            function clickHandler_<%= cleanTerritory %>( event ) {
              window.location.href = '<%= daily_path( @dailies.find_by( :territory => oneTerritory )) %>';
            }
        <% end %>
      }
    </script>
  </head>

  <body>
    <% @uTerritories.each do |oneTerritory| %>
      <% cleanTerritory = oneTerritory.gsub( /[^0-9a-z]/i, '' ) %>
      <div  style="display: inline-block"  id="chart_div_<%= cleanTerritory %>"  width=50%> </div>
    <% end %>
  </body>
</html>
